<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{server_name}} - 30å¤©çµ±è¨ˆå ±è¡¨</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #6200ee;
            --primary-variant: #3700b3;
            --secondary: #03dac6;
            --background: #ffffff;
            --surface: #ffffff;
            --error: #b00020;
            --on-primary: #ffffff;
            --on-secondary: #000000;
            --on-background: #000000;
            --on-surface: #000000;
            --on-error: #ffffff;
            --text-primary: rgba(0, 0, 0, 0.87);
            --text-secondary: rgba(0, 0, 0, 0.6);
            --divider: rgba(0, 0, 0, 0.12);
        }

        .dark-mode {
            --primary: #bb86fc;
            --primary-variant: #3700b3;
            --secondary: #03dac6;
            --background: #121212;
            --surface: #1e1e1e;
            --error: #cf6679;
            --on-primary: #000000;
            --on-secondary: #000000;
            --on-background: #ffffff;
            --on-surface: #ffffff;
            --on-error: #000000;
            --text-primary: rgba(255, 255, 255, 0.87);
            --text-secondary: rgba(255, 255, 255, 0.6);
            --divider: rgba(255, 255, 255, 0.12);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: var(--background);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background-color: var(--surface);
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .title {
            font-size: 2.5rem;
            font-weight: 500;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.3rem;
            color: var(--text-secondary);
        }

        .section {
            margin-bottom: 40px;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 500;
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary);
        }

        .card {
            background-color: var(--surface);
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            overflow: hidden;
        }

        .card-header {
            padding: 16px 24px;
            border-bottom: 1px solid var(--divider);
            font-size: 1.2rem;
            font-weight: 500;
        }

        .card-content {
            padding: 24px;
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin-bottom: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: var(--surface);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin: 10px 0;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .list {
            list-style: none;
        }

        .list-item {
            padding: 12px 0;
            border-bottom: 1px solid var(--divider);
        }

        .list-item:last-child {
            border-bottom: none;
        }

        .toggle-theme {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: var(--primary);
            color: var(--on-primary);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            font-size: 1.2rem;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .chart-container {
                height: 300px;
            }

            .title {
                font-size: 2rem;
            }

            .subtitle {
                font-size: 1.1rem;
            }
        }
    </style>
</head>
<body>
<button class="toggle-theme" onclick="toggleTheme()">ğŸŒ™</button>

<div class="container">
    <div class="header">
        <h1 class="title">{{server_name}}</h1>
        <p class="subtitle">30å¤©çµ±è¨ˆå ±è¡¨ï¼ˆ{{report_date_range}}ï¼‰</p>
    </div>

    <!-- è¶¨å‹¢åˆ†æ -->
    <div class="section">
        <h2 class="section-title">è¶¨å‹¢åˆ†æ</h2>

        <div class="card">
            <div class="card-header">30å¤©å…¨æœåœ¨ç·šäººæ•¸è¶¨å‹¢</div>
            <div class="card-content">
                <div class="chart-container">
                    <canvas id="overallOnlineTrendChart"></canvas>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">30å¤©ç©å®¶éŠç©æ™‚é•·è¶¨å‹¢</div>
            <div class="card-content">
                <div class="chart-container">
                    <canvas id="playtimeTrendChart"></canvas>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">30å¤©ä¼ºæœå™¨å…¨æœåœ¨ç·šäººæ•¸è¶¨å‹¢</div>
            <div class="card-content">
                <div class="chart-container">
                    <canvas id="serverOnlineTrendChart"></canvas>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">30å¤©ä¼ºæœå™¨å„å­æœåœ¨ç·šäººæ•¸è¶¨å‹¢</div>
            <div class="card-content">
                <div class="chart-container">
                    <canvas id="subServerOnlineTrendChart"></canvas>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">DAU/MAUæ¯”ç‡è¶¨å‹¢</div>
            <div class="card-content">
                <div class="chart-container">
                    <canvas id="dauMauRatioTrendChart"></canvas>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">30æ—¥æ–°ç©å®¶ç•™å­˜ç‡è¶¨å‹¢</div>
            <div class="card-content">
                <div class="chart-container">
                    <canvas id="retentionRateTrendChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- æ•¸æ“šæ¦‚è¦½ -->
    <div class="section">
        <h2 class="section-title">æ•¸æ“šæ¦‚è¦½</h2>

        <div class="card">
            <div class="card-header">30å¤©å…¨æœç©å®¶æ•¸é‡æ¦‚è¦½</div>
            <div class="card-content">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">æ–°ç©å®¶æ•¸é‡</div>
                        <div class="stat-value" id="newPlayersCount">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">è€ç©å®¶æ•¸é‡</div>
                        <div class="stat-value" id="oldPlayersCount">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">30å¤©ç¸½è¨ˆç©å®¶æ•¸é‡</div>
                        <div class="stat-value" id="totalPlayersCount">0</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">ç©å®¶æ´»èºåº¦åˆ†æ</div>
            <div class="card-content">
                <ul class="list">
                    <li class="list-item">
                        <strong>æ ¸å¿ƒç©å®¶æ•¸é‡ï¼ˆç™»éŒ„15å¤©ä»¥ä¸Šï¼‰:</strong> <span id="corePlayersCount">0</span>äºº
                    </li>
                    <li class="list-item">
                        <strong>æµå¤±é¢¨éšªç©å®¶æ•¸é‡ï¼ˆé€£çºŒ7å¤©æœªç™»éŒ„ï¼‰:</strong> <span id="atRiskPlayersCount">0</span>äºº
                    </li>
                    <li class="list-item">
                        <strong>å¹³å‡DAUï¼ˆæ—¥æ´»èºç”¨æˆ¶æ•¸ï¼‰:</strong> <span id="averageDAU">0</span>äºº
                    </li>
                    <li class="list-item">
                        <strong>å¹³å‡MAUï¼ˆæœˆæ´»èºç”¨æˆ¶æ•¸ï¼‰:</strong> <span id="averageMAU">0</span>äºº
                    </li>
                    <li class="list-item">
                        <strong>ç”¨æˆ¶ç²˜æ€§ï¼ˆDAU/MAUæ¯”ç‡ï¼‰:</strong> <span id="dauMauRatio">0</span>%
                    </li>
                    <li class="list-item">
                        <strong>å¹³å‡æœƒè©±æ™‚é•·:</strong> <span id="averageSessionDuration">0</span>åˆ†é˜
                    </li>
                    <li class="list-item">
                        <strong>ç©å®¶æ´»èºåº¦ç•°å¸¸æ³¢å‹•é è­¦:</strong> <span id="activityFluctuationAlert">æª¢æ¸¬åˆ°0æ¬¡ç•°å¸¸æ³¢å‹•</span>
                    </li>
                    <li class="list-item">
                        <strong>ç©å®¶æµå¤±é è­¦:</strong> <span id="playerLossWarning">0åç©å®¶æœ‰æµå¤±é¢¨éšª</span>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <!-- åˆ†ä½ˆåˆ†æ -->
    <div class="section">
        <h2 class="section-title">åˆ†ä½ˆåˆ†æ</h2>

        <div class="card">
            <div class="card-header">ç©å®¶ä¸Šç·šæ™‚é–“æ®µçš„ä½”æ¯”ï¼ˆ0-24å°æ™‚ï¼‰</div>
            <div class="card-content">
                <div class="chart-container">
                    <canvas id="hourlyDistributionChart"></canvas>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">ç©å®¶ç™»éŒ„æ™‚é–“æ®µçš„ä½”æ¯”ï¼ˆé€±ä¸€-é€±æ—¥ï¼‰</div>
            <div class="card-content">
                <div class="chart-container">
                    <canvas id="weeklyDistributionChart"></canvas>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">æ–°è€ç©å®¶çš„ä½”æ¯”</div>
            <div class="card-content">
                <div class="chart-container">
                    <canvas id="newOldPlayerDistributionChart"></canvas>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">æ´»èºç©å®¶å±¤ç´šåˆ†ä½ˆï¼ˆè¼•åº¦/ä¸­åº¦/é‡åº¦æ´»èºï¼‰</div>
            <div class="card-content">
                <div class="chart-container">
                    <canvas id="activityLevelDistributionChart"></canvas>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">ç©å®¶ç”Ÿå‘½é€±æœŸåˆ†ä½ˆï¼ˆæ–°ç©å®¶/æˆé•·æœŸ/æˆç†ŸæœŸ/æ²‰é»˜æœŸï¼‰</div>
            <div class="card-content">
                <div class="chart-container">
                    <canvas id="lifecycleDistributionChart"></canvas>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">ç©å®¶ä¼ºæœå™¨åˆ†ä½ˆï¼ˆå„ä¼ºæœå™¨åœ¨ç·šäººæ•¸ä½”æ¯”ï¼‰</div>
            <div class="card-content">
                <div class="chart-container">
                    <canvas id="serverDistributionChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- æ’è¡Œæ¦œ -->
    <div class="section">
        <h2 class="section-title">æ’è¡Œæ¦œ</h2>

        <div class="card">
            <div class="card-header">30å¤©å…§æœ€é•·åœ¨ç·šç©å®¶å‰ä¸‰å</div>
            <div class="card-content">
                <ol class="list" id="topPlayersList">
                    <li class="list-item">æš«ç„¡æ•¸æ“š</li>
                </ol>
            </div>
        </div>

        <div class="card">
            <div class="card-header">30å¤©å…§ç©å®¶äººæ•¸æœ€å¤šçš„ä¸‰å¤©</div>
            <div class="card-content">
                <ol class="list" id="topPlayerDaysList">
                    <li class="list-item">æš«ç„¡æ•¸æ“š</li>
                </ol>
            </div>
        </div>

        <div class="card">
            <div class="card-header">æœ€å—æ­¡è¿çš„ä¸‰å€‹ä¼ºæœå™¨</div>
            <div class="card-content">
                <ol class="list" id="popularServersList">
                    <li class="list-item">æš«ç„¡æ•¸æ“š</li>
                </ol>
            </div>
        </div>
    </div>
</div>

<script>
    // å¾æ¨¡æ¿ä¸­ç²å–å ±è¡¨æ•¸æ“š
    const reportData = {{report_data}};

    // ä¸»é¡Œåˆ‡æ›åŠŸèƒ½
    function toggleTheme() {
        document.body.classList.toggle('dark-mode');
        const button = document.querySelector('.toggle-theme');
        if (document.body.classList.contains('dark-mode')) {
            button.textContent = 'â˜€ï¸';
        } else {
            button.textContent = 'ğŸŒ™';
        }
    }

    // åœ–è¡¨æ¸²æŸ“åŠŸèƒ½
    document.addEventListener('DOMContentLoaded', function() {
        // å¡«å……æ–‡æœ¬çµ±è¨ˆæ•¸æ“š
        fillTextData();

        // æ¸²æŸ“åœ–è¡¨
        renderCharts();
    });

    function fillTextData() {
        // ç©å®¶çµ±è¨ˆæ•¸æ“š
        if (reportData.playerStats) {
            document.getElementById('newPlayersCount').textContent = reportData.playerStats.new || 0;
            document.getElementById('oldPlayersCount').textContent = reportData.playerStats.old || 0;
            document.getElementById('totalPlayersCount').textContent = reportData.playerStats.total || 0;
        }

        // ç©å®¶æ´»èºåº¦æ•¸æ“š
        if (reportData.playerActivity) {
            document.getElementById('corePlayersCount').textContent = reportData.playerActivity.corePlayers || 0;
            document.getElementById('atRiskPlayersCount').textContent = reportData.playerActivity.atRiskPlayers || 0;
        }

        // DAUæ•¸æ“š
        if (reportData.dauData) {
            document.getElementById('averageDAU').textContent = Math.round(reportData.dauData.average) || 0;
            // MAUå’Œæ¯”ç‡éœ€è¦è¨ˆç®—æˆ–å¾å…¶ä»–æ•¸æ“šç²å–
            document.getElementById('averageMAU').textContent = 'N/A';
            document.getElementById('dauMauRatio').textContent = 'N/A';
        }

        // æœƒè©±æ™‚é•·
        document.getElementById('averageSessionDuration').textContent = 'N/A';

        // é è­¦ä¿¡æ¯
        document.getElementById('activityFluctuationAlert').textContent = 'æª¢æ¸¬åˆ°0æ¬¡ç•°å¸¸æ³¢å‹•';
        document.getElementById('playerLossWarning').textContent = '0åç©å®¶æœ‰æµå¤±é¢¨éšª';

        // å¡«å……åˆ—è¡¨æ•¸æ“š
        fillListData();
    }

    function fillListData() {
        // æœ€é•·åœ¨ç·šæ™‚é–“çš„ç©å®¶TOPåˆ—è¡¨
        if (reportData.topPlayers && reportData.topPlayers.length > 0) {
            const topPlayersList = document.getElementById('topPlayersList');
            topPlayersList.innerHTML = '';
            reportData.topPlayers.forEach(player => {
                const li = document.createElement('li');
                li.className = 'list-item';
                li.innerHTML = `<strong>${player.username}</strong> - ç¸½æ™‚é•·: ${player.playTime} <a href="#">(æŸ¥çœ‹è©³æƒ…)</a>`;
                topPlayersList.appendChild(li);
            });
        }

        // æ¯æ—¥ç©å®¶æ•¸é‡æœ€å¤šçš„å¹¾å¤©
        if (reportData.topPlayerDays) {
            const topPlayerDaysList = document.getElementById('topPlayerDaysList');
            topPlayerDaysList.innerHTML = '';
            Object.entries(reportData.topPlayerDays).forEach(([date, count]) => {
                const li = document.createElement('li');
                li.className = 'list-item';
                li.innerHTML = `<strong>${date}</strong> - åœ¨ç·šäººæ•¸: ${count}äºº`;
                topPlayerDaysList.appendChild(li);
            });
        }

        // æœ€å—æ­¡è¿çš„ä¼ºæœå™¨åˆ—è¡¨
        if (reportData.popularServers && reportData.popularServers.length > 0) {
            const popularServersList = document.getElementById('popularServersList');
            popularServersList.innerHTML = '';
            reportData.popularServers.forEach(server => {
                const li = document.createElement('li');
                li.className = 'list-item';
                li.innerHTML = `<strong>${server.serverName}</strong> - å¹³å‡åœ¨ç·šæ™‚é•·: ${server.avgPlayTimeMinutes}åˆ†é˜`;
                popularServersList.appendChild(li);
            });
        }
    }

    function renderCharts() {
        // æ¸²æŸ“æ¯æ—¥å³°å€¼åœ¨ç·šäººæ•¸è¶¨å‹¢åœ–
        if (reportData.dailyPeakOnline) {
            const dates = Object.keys(reportData.dailyPeakOnline);
            const values = Object.values(reportData.dailyPeakOnline);

            const ctx = document.getElementById('overallOnlineTrendChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'åœ¨ç·šäººæ•¸',
                        data: values,
                        borderColor: '#6200ee',
                        backgroundColor: 'rgba(98, 0, 238, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // æ¸²æŸ“ç©å®¶ä¸Šç·šæ™‚é–“æ®µåˆ†ä½ˆåœ–
        if (reportData.hourlyDistribution) {
            const hours = Object.keys(reportData.hourlyDistribution);
            const counts = Object.values(reportData.hourlyDistribution);
            const labels = hours.map(h => `${h}æ™‚-${(parseInt(h)+1)%24}æ™‚`);

            const ctx = document.getElementById('hourlyDistributionChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: counts,
                        backgroundColor: hours.map((_, i) => `hsl(${i * 15}, 70%, 60%)`)
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        }
                    }
                }
            });
        }

        // æ¸²æŸ“ç©å®¶ç™»éŒ„æ˜ŸæœŸåˆ†ä½ˆåœ–
        if (reportData.weeklyDistribution) {
            const weekdays = ['é€±ä¸€', 'é€±äºŒ', 'é€±ä¸‰', 'é€±å››', 'é€±äº”', 'é€±å…­', 'é€±æ—¥'];
            const counts = [1, 2, 3, 4, 5, 6, 7].map(day => reportData.weeklyDistribution[day] || 0);

            const ctx = document.getElementById('weeklyDistributionChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: weekdays,
                    datasets: [{
                        data: counts,
                        backgroundColor: [
                            '#6200ee', '#3700b3', '#bb86fc',
                            '#03dac6', '#018786', '#3700b3', '#6200ee'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        }
                    }
                }
            });
        }

        // æ¸²æŸ“æ–°è€ç©å®¶ä½”æ¯”åœ–
        if (reportData.playerStats) {
            const ctx = document.getElementById('newOldPlayerDistributionChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['æ–°ç©å®¶', 'è€ç©å®¶'],
                    datasets: [{
                        data: [reportData.playerStats.new || 0, reportData.playerStats.old || 0],
                        backgroundColor: ['#6200ee', '#03dac6']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        }
                    }
                }
            });
        }

        // æ¸²æŸ“ä¼ºæœå™¨åˆ†ä½ˆåœ–
        if (reportData.serverDistribution) {
            const servers = Object.keys(reportData.serverDistribution);
            const counts = Object.values(reportData.serverDistribution);

            const ctx = document.getElementById('serverDistributionChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: servers,
                    datasets: [{
                        data: counts,
                        backgroundColor: servers.map((_, i) => `hsl(${i * 60}, 70%, 60%)`)
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        }
                    }
                }
            });
        }

        // å…¶ä»–ä½”ä½åœ–è¡¨ï¼ˆéœ€è¦å¯¦éš›æ•¸æ“šæ”¯æŒï¼‰
        renderPlaceholderChart('playtimeTrendChart', 'ç©å®¶éŠç©æ™‚é•·è¶¨å‹¢');
        renderPlaceholderChart('serverOnlineTrendChart', 'ä¼ºæœå™¨å…¨æœåœ¨ç·šäººæ•¸è¶¨å‹¢');
        renderPlaceholderChart('subServerOnlineTrendChart', 'å„å­æœåœ¨ç·šäººæ•¸è¶¨å‹¢');
        renderPlaceholderChart('dauMauRatioTrendChart', 'DAU/MAUæ¯”ç‡è¶¨å‹¢');
        renderPlaceholderChart('retentionRateTrendChart', 'æ–°ç©å®¶ç•™å­˜ç‡è¶¨å‹¢');
        renderPlaceholderChart('activityLevelDistributionChart', 'æ´»èºç©å®¶å±¤ç´šåˆ†ä½ˆ');
        renderPlaceholderChart('lifecycleDistributionChart', 'ç©å®¶ç”Ÿå‘½é€±æœŸåˆ†ä½ˆ');
    }

    function renderPlaceholderChart(chartId, label) {
        const ctx = document.getElementById(chartId).getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['1æ—¥', '5æ—¥', '10æ—¥', '15æ—¥', '20æ—¥', '25æ—¥', '30æ—¥'],
                datasets: [{
                    label: label,
                    data: [0, 0, 0, 0, 0, 0, 0],
                    borderColor: '#bb86fc',
                    backgroundColor: 'rgba(187, 134, 252, 0.1)',
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }
</script>
</body>
</html>
