<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{server_name}} - 30-Day Statistics Report</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #6200ee;
            --primary-variant: #3700b3;
            --secondary: #03dac6;
            --background: #ffffff;
            --surface: #ffffff;
            --error: #b00020;
            --on-primary: #ffffff;
            --on-secondary: #000000;
            --on-background: #000000;
            --on-surface: #000000;
            --on-error: #ffffff;
            --text-primary: rgba(0, 0, 0, 0.87);
            --text-secondary: rgba(0, 0, 0, 0.6);
            --divider: rgba(0, 0, 0, 0.12);
        }

        .dark-mode {
            --primary: #bb86fc;
            --primary-variant: #3700b3;
            --secondary: #03dac6;
            --background: #121212;
            --surface: #1e1e1e;
            --error: #cf6679;
            --on-primary: #000000;
            --on-secondary: #000000;
            --on-background: #ffffff;
            --on-surface: #ffffff;
            --on-error: #000000;
            --text-primary: rgba(255, 255, 255, 0.87);
            --text-secondary: rgba(255, 255, 255, 0.6);
            --divider: rgba(255, 255, 255, 0.12);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--background);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background-color: var(--surface);
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .title {
            font-size: 2.5rem;
            font-weight: 500;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.3rem;
            color: var(--text-secondary);
        }

        .section {
            margin-bottom: 40px;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 500;
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary);
        }

        .card {
            background-color: var(--surface);
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            overflow: hidden;
        }

        .card-header {
            padding: 16px 24px;
            border-bottom: 1px solid var(--divider);
            font-size: 1.2rem;
            font-weight: 500;
        }

        .card-content {
            padding: 24px;
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin-bottom: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: var(--surface);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin: 10px 0;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .list {
            list-style: none;
        }

        .list-item {
            padding: 12px 0;
            border-bottom: 1px solid var(--divider);
        }

        .list-item:last-child {
            border-bottom: none;
        }

        .toggle-theme {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: var(--primary);
            color: var(--on-primary);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            font-size: 1.2rem;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .chart-container {
                height: 300px;
            }

            .title {
                font-size: 2rem;
            }

            .subtitle {
                font-size: 1.1rem;
            }
        }
    </style>
</head>
<body>
<button class="toggle-theme" onclick="toggleTheme()">🌙</button>

<div class="container">
    <div class="header">
        <h1 class="title">{{server_name}}</h1>
        <p class="subtitle">30-Day Statistics Report ({{report_date_range}})</p>
    </div>

    <!-- Trend Analysis -->
    <div class="section">
        <h2 class="section-title">Trend Analysis</h2>

        <div class="card">
            <div class="card-header">30-Day Overall Server Online Trend</div>
            <div class="card-content">
                <div class="chart-container">
                    <canvas id="overallOnlineTrendChart"></canvas>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">30-Day Player Playtime Trend</div>
            <div class="card-content">
                <div class="chart-container">
                    <canvas id="playtimeTrendChart"></canvas>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">30-Day Server Overall Online Trend</div>
            <div class="card-content">
                <div class="chart-container">
                    <canvas id="serverOnlineTrendChart"></canvas>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">30-Day Sub-server Online Trend</div>
            <div class="card-content">
                <div class="chart-container">
                    <canvas id="subServerOnlineTrendChart"></canvas>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">DAU/MAU Ratio Trend</div>
            <div class="card-content">
                <div class="chart-container">
                    <canvas id="dauMauRatioTrendChart"></canvas>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">30-Day New Player Retention Rate Trend</div>
            <div class="card-content">
                <div class="chart-container">
                    <canvas id="retentionRateTrendChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Data Overview -->
    <div class="section">
        <h2 class="section-title">Data Overview</h2>

        <div class="card">
            <div class="card-header">30-Day Overall Player Statistics</div>
            <div class="card-content">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">New Players</div>
                        <div class="stat-value" id="newPlayersCount">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Returning Players</div>
                        <div class="stat-value" id="oldPlayersCount">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Players (30 Days)</div>
                        <div class="stat-value" id="totalPlayersCount">0</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">Player Activity Analysis</div>
            <div class="card-content">
                <ul class="list">
                    <li class="list-item">
                        <strong>Core Players (logged in >15 days):</strong> <span id="corePlayersCount">0</span>
                    </li>
                    <li class="list-item">
                        <strong>At-risk Players (7+ days inactive):</strong> <span id="atRiskPlayersCount">0</span>
                    </li>
                    <li class="list-item">
                        <strong>Average DAU (Daily Active Users):</strong> <span id="averageDAU">0</span>
                    </li>
                    <li class="list-item">
                        <strong>Average MAU (Monthly Active Users):</strong> <span id="averageMAU">0</span>
                    </li>
                    <li class="list-item">
                        <strong>User Engagement (DAU/MAU Ratio):</strong> <span id="dauMauRatio">0</span>%
                    </li>
                    <li class="list-item">
                        <strong>Average Session Duration:</strong> <span id="averageSessionDuration">0</span> minutes
                    </li>
                    <li class="list-item">
                        <strong>Player Activity Fluctuation Alert:</strong> <span id="activityFluctuationAlert">0 anomalies detected</span>
                    </li>
                    <li class="list-item">
                        <strong>Player Loss Warning:</strong> <span id="playerLossWarning">0 players at risk of churning</span>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Distribution Analysis -->
    <div class="section">
        <h2 class="section-title">Distribution Analysis</h2>

        <div class="card">
            <div class="card-header">Player Login Time Distribution (0-24 Hours)</div>
            <div class="card-content">
                <div class="chart-container">
                    <canvas id="hourlyDistributionChart"></canvas>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">Player Login Day Distribution (Monday-Sunday)</div>
            <div class="card-content">
                <div class="chart-container">
                    <canvas id="weeklyDistributionChart"></canvas>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">New vs Returning Players Distribution</div>
            <div class="card-content">
                <div class="chart-container">
                    <canvas id="newOldPlayerDistributionChart"></canvas>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">Player Activity Level Distribution (Light/Medium/Heavy)</div>
            <div class="card-content">
                <div class="chart-container">
                    <canvas id="activityLevelDistributionChart"></canvas>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">Player Lifecycle Distribution (New/Growing/Mature/Inactive)</div>
            <div class="card-content">
                <div class="chart-container">
                    <canvas id="lifecycleDistributionChart"></canvas>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">Player Server Distribution (Online Players by Server)</div>
            <div class="card-content">
                <div class="chart-container">
                    <canvas id="serverDistributionChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Leaderboard -->
    <div class="section">
        <h2 class="section-title">Leaderboard</h2>

        <div class="card">
            <div class="card-header">Top 3 Players by Online Time (30 Days)</div>
            <div class="card-content">
                <ol class="list" id="topPlayersList">
                    <li class="list-item">No data available</li>
                </ol>
            </div>
        </div>

        <div class="card">
            <div class="card-header">Top 3 Days by Player Count (30 Days)</div>
            <div class="card-content">
                <ol class="list" id="topPlayerDaysList">
                    <li class="list-item">No data available</li>
                </ol>
            </div>
        </div>

        <div class="card">
            <div class="card-header">Top 3 Most Popular Servers</div>
            <div class="card-content">
                <ol class="list" id="popularServersList">
                    <li class="list-item">No data available</li>
                </ol>
            </div>
        </div>
    </div>
</div>

<script>
    // Get report data from template
    const reportData = {{report_data}};

    // Theme toggle function
    function toggleTheme() {
        document.body.classList.toggle('dark-mode');
        const button = document.querySelector('.toggle-theme');
        if (document.body.classList.contains('dark-mode')) {
            button.textContent = '☀️';
        } else {
            button.textContent = '🌙';
        }
    }

    // Chart rendering functions
    document.addEventListener('DOMContentLoaded', function() {
        // Fill text data
        fillTextData();

        // Render charts
        renderCharts();
    });

    function fillTextData() {
        // Player statistics
        if (reportData.playerStats) {
            document.getElementById('newPlayersCount').textContent = reportData.playerStats.new || 0;
            document.getElementById('oldPlayersCount').textContent = reportData.playerStats.old || 0;
            document.getElementById('totalPlayersCount').textContent = reportData.playerStats.total || 0;
        }

        // Player activity data
        if (reportData.playerActivity) {
            document.getElementById('corePlayersCount').textContent = reportData.playerActivity.corePlayers || 0;
            document.getElementById('atRiskPlayersCount').textContent = reportData.playerActivity.atRiskPlayers || 0;
        }

        // DAU data
        if (reportData.dauData) {
            document.getElementById('averageDAU').textContent = Math.round(reportData.dauData.average) || 0;
            // MAU and ratio need to be calculated or obtained from other data
            document.getElementById('averageMAU').textContent = 'N/A';
            document.getElementById('dauMauRatio').textContent = 'N/A';
        }

        // Session duration
        document.getElementById('averageSessionDuration').textContent = 'N/A';

        // Alert information
        document.getElementById('activityFluctuationAlert').textContent = '0 anomalies detected';
        document.getElementById('playerLossWarning').textContent = '0 players at risk of churning';

        // Fill list data
        fillListData();
    }

    function fillListData() {
        // Top players by play time
        if (reportData.topPlayers && reportData.topPlayers.length > 0) {
            const topPlayersList = document.getElementById('topPlayersList');
            topPlayersList.innerHTML = '';
            reportData.topPlayers.forEach(player => {
                const li = document.createElement('li');
                li.className = 'list-item';
                li.innerHTML = `<strong>${player.username}</strong> - Total Time: ${player.playTime} <a href="#">(Details)</a>`;
                topPlayersList.appendChild(li);
            });
        }

        // Top player days
        if (reportData.topPlayerDays) {
            const topPlayerDaysList = document.getElementById('topPlayerDaysList');
            topPlayerDaysList.innerHTML = '';
            Object.entries(reportData.topPlayerDays).forEach(([date, count]) => {
                const li = document.createElement('li');
                li.className = 'list-item';
                li.innerHTML = `<strong>${date}</strong> - Online Players: ${count}`;
                topPlayerDaysList.appendChild(li);
            });
        }

        // Popular servers
        if (reportData.popularServers && reportData.popularServers.length > 0) {
            const popularServersList = document.getElementById('popularServersList');
            popularServersList.innerHTML = '';
            reportData.popularServers.forEach(server => {
                const li = document.createElement('li');
                li.className = 'list-item';
                li.innerHTML = `<strong>${server.serverName}</strong> - Avg. Online Time: ${server.avgPlayTimeMinutes} minutes`;
                popularServersList.appendChild(li);
            });
        }
    }

    function renderCharts() {
        // Render daily peak online trend chart
        if (reportData.dailyPeakOnline) {
            const dates = Object.keys(reportData.dailyPeakOnline);
            const values = Object.values(reportData.dailyPeakOnline);

            const ctx = document.getElementById('overallOnlineTrendChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'Online Players',
                        data: values,
                        borderColor: '#6200ee',
                        backgroundColor: 'rgba(98, 0, 238, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Render player login time distribution chart
        if (reportData.hourlyDistribution) {
            const hours = Object.keys(reportData.hourlyDistribution);
            const counts = Object.values(reportData.hourlyDistribution);
            const labels = hours.map(h => `${h}:00-${(parseInt(h)+1)%24}:00`);

            const ctx = document.getElementById('hourlyDistributionChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: counts,
                        backgroundColor: hours.map((_, i) => `hsl(${i * 15}, 70%, 60%)`)
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        }
                    }
                }
            });
        }

        // Render player login day distribution chart
        if (reportData.weeklyDistribution) {
            const weekdays = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
            const counts = [1, 2, 3, 4, 5, 6, 7].map(day => reportData.weeklyDistribution[day] || 0);

            const ctx = document.getElementById('weeklyDistributionChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: weekdays,
                    datasets: [{
                        data: counts,
                        backgroundColor: [
                            '#6200ee', '#3700b3', '#bb86fc',
                            '#03dac6', '#018786', '#3700b3', '#6200ee'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        }
                    }
                }
            });
        }

        // Render new vs returning players distribution chart
        if (reportData.playerStats) {
            const ctx = document.getElementById('newOldPlayerDistributionChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['New Players', 'Returning Players'],
                    datasets: [{
                        data: [reportData.playerStats.new || 0, reportData.playerStats.old || 0],
                        backgroundColor: ['#6200ee', '#03dac6']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        }
                    }
                }
            });
        }

        // Render server distribution chart
        if (reportData.serverDistribution) {
            const servers = Object.keys(reportData.serverDistribution);
            const counts = Object.values(reportData.serverDistribution);

            const ctx = document.getElementById('serverDistributionChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: servers,
                    datasets: [{
                        data: counts,
                        backgroundColor: servers.map((_, i) => `hsl(${i * 60}, 70%, 60%)`)
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        }
                    }
                }
            });
        }

        // Placeholder charts (require actual data support)
        renderPlaceholderChart('playtimeTrendChart', 'Player Playtime Trend');
        renderPlaceholderChart('serverOnlineTrendChart', 'Server Overall Online Trend');
        renderPlaceholderChart('subServerOnlineTrendChart', 'Sub-server Online Trend');
        renderPlaceholderChart('dauMauRatioTrendChart', 'DAU/MAU Ratio Trend');
        renderPlaceholderChart('retentionRateTrendChart', 'New Player Retention Rate Trend');
        renderPlaceholderChart('activityLevelDistributionChart', 'Player Activity Level Distribution');
        renderPlaceholderChart('lifecycleDistributionChart', 'Player Lifecycle Distribution');
    }

    function renderPlaceholderChart(chartId, label) {
        const ctx = document.getElementById(chartId).getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Day 1', 'Day 5', 'Day 10', 'Day 15', 'Day 20', 'Day 25', 'Day 30'],
                datasets: [{
                    label: label,
                    data: [0, 0, 0, 0, 0, 0, 0],
                    borderColor: '#bb86fc',
                    backgroundColor: 'rgba(187, 134, 252, 0.1)',
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }
</script>
</body>
</html>
